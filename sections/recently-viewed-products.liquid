<script type="module" src="{{ 'slider.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'recently-viewed-products.js' | asset_url }}" defer="defer"></script>

{% liquid
    assign products_source = section.settings.collection.products
    assign show_section = false
  
    if section.settings.product_list != empty
      assign products_source = section.settings.product_list
    endif
  
    if request.design_mode == true or section.settings.hide_empty_section == false or section.settings.hide_empty_section == true and products_source != blank
      assign show_section = true
    endif
  %}

    {{ 'swiper.css' | asset_url | stylesheet_tag }}
  
    {% assign background_rgb = section.settings.background_color | color_to_rgb %}
    {% assign text_rgb = section.settings['color-body-text'] | color_to_rgb %}
  
    <style>
        [data-section-id="{{ section.id }}"]
        {
  
        {% if background_rgb != 'rgba(0, 0, 0, 0.0)' %}
          --color-background: {{ section.settings.background_color }};
        {% endif %}
  
        {% if section.settings.margin-top %}
          --section-gap-top: {{ section.settings.margin-top }}px;
        {% endif %}
  
        {% if section.settings.margin-bottom %}
          --section-gap-bottom: {{ section.settings.margin-bottom }}px;
        {% endif %}
  
      }
  
      [data-section-id="{{ section.id }}"]
      {
        {% if text_rgb != 'rgba(0, 0, 0, 0.0)' %}
          --color-custom-text: {{ section.settings.color-body-text }};
          --color-price: {{ section.settings.color-body-text }};
          --color-brand: {{ section.settings.color-body-text }};
          --color-star-rating: {{ section.settings.color-body-text }};
        {% endif %}
        {% if section.settings.enable_stack_products %}
          --grid-col-mobile:{{ section.settings.number_of_column_mobile | floor }};
          --grid-col:{{ section.settings.number_of_column_desktop | floor }};
          --grid-gap: {{ section.settings.spacing_desktop }}px;
        {% endif %}
        --grid-gap-mobile: {{ section.settings.spacing_mobile }}px;
      }
    </style>
    {% if section.settings.enable_quick_add_button %}
      <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
      <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
      <script src="{{ 'variant-dropdown.js' | asset_url }}" defer="defer"></script>
    {% endif %}

    <div
      data-section-id="{{ section.id }}"
      class="wt-featured-collection wt-slider {% if section.settings.disable_on_mobile %}wt-featured-collection--disable-on-mobile{% endif %}"
    >
      {% if section.settings.title != blank %}
        <div class="headline {% if settings.animations %} scroll-trigger animate--slide-in {% endif %} {% if settings.disabled_animations_on_mobile %} disabled-on-mobile {% endif %} {% if section.settings.heading_disable_on_mobile == true %} hero__title--mobile{% endif %}  {% if section.settings.disable_on_mobile %}disable-on-mobile{% endif %}">
          {% render 'simple-block', prefix: 'headline', title: section.settings.title %}
        </div>
      {% endif %}
  
    <recently-viewed-products data-shop-id="{{- shop.id -}}" 
      data-products-to-show="{{ section.settings.products_to_show }}"
      data-current-handle="{{ product.handle }}"
      {% if section.settings.hide_empty_section %}
        data-hide-empty-section
      {% endif %}
      {% if request.design_mode == true %}
        data-design-mode
      {% endif %}
      {% if template.name == 'product' %}
        data-product-template
      {% endif %}
    >
      <!-- Slider main container -->
      <slideshow-section
        class="wt-slider {% if section.settings.make_products_full_width %} wt-slider--full {% endif %}"
        data-slides-group
      >
        <div
          data-swiper
          class="wt-slider__container--featured loading  {% if section.settings.make_products_full_width %} wt-slider__container--full {% endif %}"
        >
          <!-- Additional required wrapper -->
          <div
            data-swiper-container
            {% if section.settings.enable_stack_products %}
              class=" wt-slider__wrapper--stack {% if section.settings.number_of_column_desktop == 2%} wt-slider__wrapper--stack-2-col {% endif %}"
            {% endif %}
          >
            <!-- Slides -->
            {%- if request.design_mode == true -%}
              {% for i in (1..section.settings.products_to_show) %}
                <div
                  data-swiper-slide
                  {% if i < 6 and settings.animations and forloop.index <= 2 %}
                    data-cascade
                    class="scroll-trigger animate--slide-in {% if settings.disabled_animations_on_mobile %} disabled-on-mobile {% endif %}"
                    style="--animation-order: {{ i }};"
                  {% else %}
                    class="wt-slider__card-wrapper"
                  {% endif %}
                >
                  {% assign placeholder_image_index = i | modulo: 4 %}
                  {% if placeholder_image_index == 0 %}
                    {% assign placeholder_image_index = 1 %}
                  {% endif %}
                  {% render 'card',
                    placeholder_image_index: placeholder_image_index,
                    title: 'Example product title',
                    subtitle: 'Vendor',
                    price: '1999',
                    rating: section.settings.show_product_rating,
                    options: false,
                    text_alignment: section.settings.text_alignment,
                    enable_quick_add_button: section.settings.enable_quick_add_button
                  %}
                </div>
              {% endfor %}
            {%- endif -%}
          </div>
  
          {% unless section.settings.enable_stack_products %}
            <!-- Add Arrows -->
            <div class="swiper-button-next wt-slider__nav-btn wt-slider__nav-next wt-slider__nav-next--featured">
              {% render 'icons', id: 'arrow-right' %}
            </div>
            <div class="swiper-button-prev wt-slider__nav-btn wt-slider__nav-prev wt-slider__nav-prev--featured">
              {% render 'icons', id: 'arrow-left' %}
            </div>
  
            <!-- If we need scrollbar -->
            <div
              class="swiper-scrollbar wt-slider__scrollbar wt-slider__scrollbar--featured {% if section.settings.make_products_full_width %} wt-slider__scrollbar--full {% endif %}"
            ></div>
          {% endunless %}
  
          <script data-swiper-configuration type="text/json">
            {
              "enabled": {% unless section.settings.enable_stack_products %}true{% else %}false{% endunless %},
              "slidesPerView": "auto",
              "freeMode": false,
              "centeredSlides": false,
              "slideToClickedSlide": false,
              "centeredSlidesBounds": true,
              "speed": 150,
              "grabCursor": false,
              "paginationType": "bullets",
              {% unless section.settings.enable_stack_products %}
              "breakpoints": {
                "320": {
                  "slidesPerView": {{ section.settings.number_of_column_mobile }},
                  "slidesPerGroup": {{ section.settings.number_of_column_mobile | floor }},
                  "spaceBetween": {{ section.settings.spacing_mobile | floor }}
                },
                "900": {
                  "slidesPerView": {{ section.settings.number_of_column_desktop }},
                  "slidesPerGroup": {{ section.settings.number_of_column_desktop | floor }},
                  "spaceBetween": {{ section.settings.spacing_desktop | floor }}
                }
              },
              "navigation": {
                "nextEl": ".wt-slider__nav-next--featured",
                "prevEl": ".wt-slider__nav-prev--featured"
              },
              "scrollbar": {
                "el": ".wt-slider__scrollbar--featured",
                "draggable": true
              },
            {% endunless %}
              "pagination": false
            }
          </script>
        </div>
      </slideshow-section>
      </recently-viewed-products>
    </div>
  
  {% schema %}
  {
    "name": "t:sections.recently-viewed-products.name",
    "tag": "section",
    "class": "spaced-section",
    "settings": [
      {
        "type": "paragraph",
        "content": "t:sections.recently-viewed-products.info"
      },
      {
        "type": "textarea",
        "id": "title",
        "default": "Recently viewed products",
        "label": "t:sections.featured-collection.settings.title.label"
      },
      {
        "type": "checkbox",
        "id": "hide_empty_section",
        "label": "t:sections.featured-collection.settings.hide_empty_section.label",
        "info": "t:sections.featured-collection.settings.hide_empty_section.info",
        "default": false
      },
      {
        "type": "range",
        "id": "products_to_show",
        "min": 3,
        "max": 24,
        "step": 1,
        "default": 4,
        "label": "t:sections.featured-collection.settings.products_to_show.label"
      },
      {
        "type": "checkbox",
        "id": "enable_stack_products",
        "default": false,
        "label": "t:sections.featured-collection.settings.enable_stack_products.label"
      },
      {
        "type": "header",
        "content": "t:sections.global.desktop_version"
      },
      {
        "type": "range",
        "id": "number_of_column_desktop",
        "min": 2,
        "max": 5,
        "step": 1,
        "default": 4,
        "label": "t:sections.featured-collection.settings.number_of_column_desktop.label"
      },
      {
        "type": "select",
        "id": "spacing_desktop",
        "options": [
          {
            "value": "8",
            "label": "t:sections.main-collection-product-grid.settings.spacing_desktop.1.label"
          },
          {
            "value": "16",
            "label": "t:sections.main-collection-product-grid.settings.spacing_desktop.2.label"
          },
          {
            "value": "24",
            "label": "t:sections.main-collection-product-grid.settings.spacing_desktop.3.label"
          }
        ],
        "default": "16",
        "label": "t:sections.main-collection-product-grid.settings.spacing_desktop.label"
      },
      {
        "type": "checkbox",
        "id": "make_products_full_width",
        "default": true,
        "label": "t:sections.featured-collection.settings.make_products_full_width.label"
      },
      {
        "type": "header",
        "content": "t:sections.global.mobile_version"
      },
      {
        "type": "range",
        "id": "number_of_column_mobile",
        "min": 1.1,
        "max": 2.5,
        "step": 0.1,
        "default": 2.1,
        "label": "t:sections.featured-collection.settings.number_of_column_mobile.label"
      },
      {
        "type": "select",
        "id": "spacing_mobile",
        "options": [
          {
            "value": "4",
            "label": "4px"
          },
          {
            "value": "8",
            "label": "8px"
          },
          {
            "value": "12",
            "label": "12px"
          },
          {
            "value": "16",
            "label": "16px"
          }
        ],
        "default": "16",
        "label": "t:sections.featured-collection.settings.spacing_mobile.label"
      },
      {
        "type": "header",
        "content": "t:sections.global.colors",
        "info": "t:sections.global.colors-info"
      },
      {
        "type": "color",
        "id": "color-body-text",
        "default": "transparent",
        "label": "t:sections.settings.settings.text-color.label"
      },
      {
        "type": "color",
        "id": "background_color",
        "default": "transparent",
        "label": "t:sections.settings.settings.background-color.label"
      },
      {
        "type": "header",
        "content": "t:sections.global.section_spacing"
      },
      {
        "type": "range",
        "id": "margin-top",
        "min": 0,
        "max": 100,
        "unit": "px",
        "step": 4,
        "default": 20,
        "label": "t:sections.rich-text.settings.top_distance.label"
      },
      {
        "type": "range",
        "id": "margin-bottom",
        "min": 0,
        "max": 100,
        "unit": "px",
        "step": 4,
        "default": 20,
        "label": "t:sections.rich-text.settings.bottom_distance.label",
        "info": "t:sections.separator.settings.separator-bottom.info"
      }
    ],
    "presets": [
      {
        "name": "t:sections.recently-viewed-products.name",
        "category": "t:sections.categories.products",
      }
    ],
    "disabled_on": {
      "groups": ["header", "footer"]
    }
  }
  {% endschema %}
  